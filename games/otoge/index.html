<html>
<head>
  <title>otoge</title>
  <meta name= "viewport" content = "width = device-width, initial-scale = 1.0, maximum-scale = 1.0, minimum-scale=1.0, user-scalable=0,
  minimal-ui"/>
  <style>
    canvas {
      border: 1px solid black;
      width: 100%;
    }
  </style>
</head>
<body>
  <canvas id="mycanvas" width="360" height="420" tabindex='1' ></canvas>
  <script>
    window.addEventListener("load",function() {
      
      //constants
      var GAME_WIDTH = 360;
      var GAME_HEIGHT = 420;

      //keep the game going
      var gameLive = true;

      var beatArray = [];
      var sprites = {};

      var bar = {
        w: GAME_WIDTH,
        h: 40,
        x: 0,
        y: GAME_HEIGHT - 80,
      }
      
      var Beats = function(dir){
        var dirNum;
        switch(dir){
          case "left":
          dirNum = 0
          break;
          case "down":
          dirNum = 1
          break;
          case "up":
          dirNum = 2
          break;
          case "right":
          dirNum = 3
          break;
        }

        this.arrow = dir;
        this.w = GAME_WIDTH/4;
        this.h = 40;
        this.x = dirNum * this.w;
        this.y = 0;
        this.speed = 5
      };

      var beatMaker = function(dir){
        var beat = new Beats(dir);
        beatArray.push(beat);
    }
      

      //grab the canvas and context
      var canvas = document.getElementById("mycanvas");
      var ctx = canvas.getContext("2d");

      //prevent keyDown scroll
      window.addEventListener("keydown", function(e) {
    // space and arrow keys
    if([32, 37, 38, 39, 40].indexOf(e.keyCode) > -1) {
        e.preventDefault();
    }
}, false);

      canvas.addEventListener('keydown', (event) => {
  const keyName = event.key;
      
      switch(keyName){
        case "ArrowRight":
        console.log("R")
        break;
        case "ArrowDown":
        console.log("D")
        break;
        case "ArrowUp":
        console.log("U")
        break;
        case "ArrowLeft":
        console.log("L")
        break;
      }
});

      var load = function() {
        // sprites.player = new Image();
        // sprites.player.src = 'images/';
        canvas.focus();
       resizeGame();
       window.addEventListener("resize", resizeGame);

       beatMaker("right");
       beatMaker("left");
       beatMaker("up");
       beatMaker("down");

       setInterval(function(){
        beatMaker("right");
       },1000);

      };

      //update the logic
      var update = function() {

      beatArray.forEach(function(element, index){
          element.y += element.speed;

          if (element.y > GAME_HEIGHT) {
            beatArray.splice(index,1);
          };

        });
        

        }


      //show the game on the screen
      var draw = function() {
        //clear the canvas
        ctx.clearRect(0,0,GAME_WIDTH,GAME_HEIGHT);        

        //draw background
        //ctx.drawImage(sprites.background, 0, 0);

        ctx.fillStyle = "#00FF00";
        ctx.fillRect(bar.x, bar.y, bar.w, bar.h);


        ctx.fillStyle = "#3333FF";
        beatArray.forEach(function(element, index){
          ctx.fillRect(element.x, element.y, element.w, element.h);
        });
}


      //gets executed multiple times per second
      var step = function() {

        update();
        draw();

        if(gameLive) {
          window.requestAnimationFrame(step); 
        }     
      };

      //check the collision between two rectangles
      var checkCollision = function(rect1, rect2) {

        var closeOnWidth = Math.abs(rect1.x - rect2.x) <= Math.max(rect1.w, rect2.w);
        var closeOnHeight = Math.abs(rect1.y - rect2.y) <= Math.max(rect1.h, rect2.h);
        return closeOnWidth && closeOnHeight;
      }

      //initial kick
      load();
      step();
    

    function resizeGame(){
    var canvas = document.querySelector("canvas");
    var windowWidth = window.innerWidth;
    var windowHeight = window.innerHeight;
    var windowRatio = windowWidth / windowHeight;
    var gameRatio = canvas.width / canvas.height;
    if (windowRatio < gameRatio){
        canvas.style.width = windowWidth + "px";
        canvas.style.height = (windowWidth / gameRatio) + "px";
    }else{
        canvas.style.width = (windowHeight * gameRatio) + "px";
        canvas.style.height = windowHeight + "px";
    }
  }

    });

  </script>
</body>
</html>
